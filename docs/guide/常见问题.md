---
outline: [2, 3]
---

# å¸¸è§é—®é¢˜

### Docker é•œåƒä¸‹è½½éå¸¸æ…¢æ€ä¹ˆåŠ?

è¿™ä¸€èˆ¬åœ¨å›½å†…ä¸‹è½½é•œåƒæ—¶å‡ºç°, æœ‰ä¸¤ç§ç­–ç•¥:

1. ä½¿ç”¨ Docker é•œåƒ: [æ•™ç¨‹](https://gist.github.com/y0ngb1n/7e8f16af3242c7815e7ca2f0833d3ea6)
2. ä½¿ Docker Daemon ä½¿ç”¨ä»£ç†: [æ•™ç¨‹](https://www.moralok.com/2023/06/13/how-to-configure-proxy-for-terminal-docker-and-container/)

### æˆ‘ä½¿ç”¨çš„å¹³å°æ˜¯ç¾¤æ™–ç­‰ä½å†…å­˜å¹³å°, å¯ä»¥ä½¿ç”¨å—?

Embykeeper éœ€è¦è¿è¡Œå†…å­˜ä¸º 100-300 MB, è¿™æ˜¯å› ä¸ºè¿è¡Œè¿‡ç¨‹ä¸­, éƒ¨åˆ† Bot ç­¾åˆ°éœ€è¦è¿›è¡ŒéªŒè¯ç è¯†åˆ«. å¦‚æœæ‚¨åœ¨è¿è¡Œè¿‡ç¨‹ä¸­æœ‰å†…å­˜ä¸è¶³çš„æƒ…å†µ, è¯·é€‚å½“è°ƒé«˜æ‚¨çš„è™šæ‹Ÿå†…å­˜.

å¦‚æœä¾ç„¶æ— æ³•ä½¿ç”¨, è¯·è€ƒè™‘ä½¿ç”¨ [**ğŸª åœ¨çº¿éƒ¨ç½²**](/guide/åœ¨çº¿éƒ¨ç½²).

### æˆ‘ä½¿ç”¨ Docker é¢æ¿, åå°æ—¥å¿—æ˜¾ç¤ºå¾ˆæ··ä¹± / æœ‰ ANSI é¢œè‰²å­—ç¬¦ / æ—¥å¿—é‡å¤ä¸¤é, æ€ä¹ˆåŠ?

è¯·ä½¿ç”¨å‘½ä»¤è¡Œå‚æ•° `-CL` ä»¥å¯ç”¨ç®€åŒ–æ—¥å¿—+æ— é¢œè‰²æ—¥å¿—:

```bash
docker run -v $(pwd)/embykeeper:/app --rm -it --net=host embykeeper/embykeeper -i -CL
```

å¦‚æœæ‚¨ä½¿ç”¨ `docker-compose`, è¯·ä½¿ç”¨:

```yml
version: '3'
services:
  embykeeper:
    container_name: embykeeper
    image: embykeeper/embykeeper
    command: '-CL'
    restart: unless-stopped
    volumes:
      - ./embykeeper:/app
    network_mode: host
```

å¦‚æœæ‚¨ä½¿ç”¨æºç æ„å»ºè¯·ä½¿ç”¨:

```bash
embykeeper config.toml -CL
```

### Emby ä¿æ´»æ—¶, ç»å¸¸å‡ºç° "æ— æ³•è·å–è§†é¢‘é•¿åº¦", é‡è¯•ä¹ƒè‡³å¤±è´¥æ€ä¹ˆåŠ?

è¿™è¯´æ˜è¯¥ Emby ç«™ç‚¹å¾ˆæœ‰å¯èƒ½æ˜¯é€šè¿‡ Onedrive ç›´é“¾ç­‰æ–¹æ³•æ¥å…¥çš„, å¤§éƒ¨åˆ†æˆ–æ‰€æœ‰è§†é¢‘éƒ½æ²¡æœ‰æ—¶é•¿ä¿¡æ¯.

ä½ å¯ä»¥å¼€å¯ `allow_stream` å‚æ•° (è§[æ•™ç¨‹](/guide/é…ç½®æ–‡ä»¶#emby-å­é¡¹)) ä»¥å…è®¸æ’­æ”¾è¿™ç±»è§†é¢‘.

::: tip æç¤º
å‡ºäºå®‰å…¨è€ƒè™‘, åœ¨ `allow_multiple` æ—¶ (é»˜è®¤è®¾ç½®), æ¯ä¸ªè¿™ç±»è§†é¢‘é»˜è®¤æœ€å¤šæ’­æ”¾ 8-12 åˆ†é’Ÿ, ä»¥é˜²æ­¢è®¾ç½®è¶…è¿‡è§†é¢‘å®é™…æ—¶é•¿çš„è¿›åº¦.
:::

### å¯ä¸å¯ä»¥è‡ªå®šä¹‰...

å¤§é‡çš„è‡ªå®šä¹‰å†…å®¹å‡é€šè¿‡é…ç½®æ–‡ä»¶å®ç°: [æ•™ç¨‹](/guide/é…ç½®æ–‡ä»¶)

ä¾‹å¦‚:

- è‡ªå®šä¹‰å¯ç”¨çš„ç«™ç‚¹: [æ•™ç¨‹](/guide/é…ç½®æ–‡ä»¶#%E7%AB%99%E7%82%B9%E9%85%8D%E7%BD%AE)
- è‡ªå®šä¹‰ Emby ç«™ç‚¹çš„ User-Agent: [æ•™ç¨‹](/guide/é…ç½®æ–‡ä»¶#emby-%E5%AD%90%E9%A1%B9)
- è‡ªå®šä¹‰æŸäº›ç«™ç‚¹çš„è‡ªå®šä¹‰é¡¹: [æ•™ç¨‹](/guide/é…ç½®æ–‡ä»¶#%E5%85%B6%E4%BB%96%E7%9A%84%E7%89%B9%E5%AE%9A%E7%AB%99%E7%82%B9%E9%85%8D%E7%BD%AE%E5%AD%90%E9%A1%B9)

å¦‚æœæœ‰å…¶ä»–æ‚¨éœ€è¦è‡ªå®šä¹‰çš„é¡¹ç›®, è¯·é€šè¿‡[äº¤æµç¾¤](https://t.me/embykeeper_chat_bot)æˆ–[é«˜çº§ç”¨æˆ·ç¾¤](https://t.me/embykeeper_prime_bot)åé¦ˆ, æ‚¨ä¹Ÿå¯ä»¥é€šè¿‡[çˆ±å‘ç”µ](https://afdian.com/a/jackzzs)è´­ä¹°ç§äº«å®šåˆ¶æœåŠ¡.

### è¿è¡Œæ—¶å‡ºç°äº†é”™è¯¯, æ€ä¹ˆè§£å†³?

é¦–å…ˆ, è¯·æ£€æŸ¥æ‚¨çš„é”™è¯¯æ˜¯å¦ä¸ä»¥ä¸‹æœ‰å…³:

1. æ›´æ–°æ§åˆ¶å™¨é”™è¯¯.
2. `Connection reset by peer`.
3. `ConnectionError`.

ä»¥ä¸Šå‡ä¸ºç½‘ç»œæ³¢åŠ¨æˆ–å›½é™…ç½‘ç»œä¸é€šå¯¼è‡´çš„é—®é¢˜, è¯·ä¼˜åŒ–æ‚¨çš„ç½‘ç»œç¯å¢ƒ.

å…¶ä»–é—®é¢˜è¯·[åé¦ˆ](#å¦‚ä½•åé¦ˆ), è°¢è°¢æ‚¨çš„æ”¯æŒ.

### å¦‚ä½•åé¦ˆ?

é¦–å…ˆ, è¯·ä½¿ç”¨å·¦ä¸Šè§’çš„æœç´¢, æœç´¢ç›¸å…³é—®é¢˜, æ‚¨å¯ä»¥å‚ç…§å³ä¾§èœå•å¯»æ‰¾ç›¸å…³çš„è§£å†³æ–¹æ¡ˆ, è¿™é€šå¸¸å¯ä»¥è§£ç­”å¤§éƒ¨åˆ†çš„ç–‘é—®, ä¸”æ›´åŠ ä¾¿æ·.

è‹¥æ‚¨çš„ç–‘é—®æ²¡æœ‰å¾—åˆ°è§£ç­”, æ‚¨å¯ä»¥é€šè¿‡[è®¨è®ºç¾¤](https://t.me/embykeeper_chat_bot)å’Œ[é«˜çº§ç”¨æˆ·è®¨è®ºç¾¤](https://t.me/embykeeper_prime_bot)è¿›è¡Œåé¦ˆ, å…¶ä¸­é«˜çº§ç”¨æˆ·è®¨è®ºç¾¤ä»…é™[é«˜çº§ç”¨æˆ·](/guide/é«˜çº§ç”¨æˆ·)åŠ å…¥, ä¸”æœ‰å¼€å‘è€…æ¯”è¾ƒåŠæ—¶çš„å“åº”.

å¦‚æœæ‚¨å‘ç°ä¸€ä¸ªç¨‹åºä¸Šçš„é”™è¯¯æˆ–é—®é¢˜, æ‚¨ä¹Ÿå¯ä»¥é€šè¿‡ [Github Issues](https://github.com/emby-keeper/emby-keeper/issues) è¿›è¡Œåé¦ˆ.

### åœ¨ Telegram ç¾¤ç»„è®¨è®º, æ˜¯å¦æœ‰è¢«è®¤å‡ºçš„é£é™©?

æˆ‘ä»¬çš„ç›¸å…³è®¨è®ºç»„([äº¤æµç¾¤](https://t.me/embykeeper_chat_bot)æˆ–[é«˜çº§ç”¨æˆ·ç¾¤](https://t.me/embykeeper_prime_bot))å‡å®ç°äº†å®Œå…¨åŒ¿å.

åŒ¿åç¾¤ç»„å®é™…ä¸Šæ˜¯ä¸€ä¸ªæœºå™¨äºº, å‘é€çš„æ¶ˆæ¯ä¼šè¢«å¹¿æ’­ç»™æ‰€æœ‰å…¶ä»–ç”¨æˆ·, ä»è€Œå®ç°ç¾¤èŠçš„æ•ˆæœ. åŒæ—¶åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­æ‚¨çš„æ‰€æœ‰ä¸ªäººä¿¡æ¯ (åŒ…æ‹¬ å¤´åƒ / ç”¨æˆ·å / æ‰‹æœºå· / è¾“å…¥çŠ¶æ€ / åœ¨çº¿çŠ¶æ€ ç­‰) å‡ä¼šè¢«éšè—, æ‚¨å°†ä»¥ä¸€ä¸ª emoji ä½œä¸ºé¢å…·ä½œä¸ºèº«ä»½ä»£å·. æ‰€ä»¥åœ¨è¿™ç§ç¾¤ç»„ä¸­èŠå¤©æ˜¯ç»å¯¹å®‰å…¨çš„.

ä½†æ˜¯, æ‚¨éœ€è¦æ³¨æ„ä¸è¦åœ¨æˆªå›¾/åé¦ˆä¿¡æ¯ä¸­å¸¦æœ‰ä¸ªäººéšç§ (åŒ…æ‹¬æ‰‹æœºå· / Telegram UID / ç”¨æˆ·å) ç­‰, è‹¥æ‚¨éœ€è¦å‘é€è¿™äº›ä¿¡æ¯ç»™å¼€å‘è€…, é«˜çº§ç”¨æˆ·è¯·ç›´æ¥å‘é€åˆ° [PMBot](https://t.me/embykeeper_pm_bot), å…¶ä»–ç”¨æˆ·è¯·ä½¿ç”¨é©¬èµ›å…‹é®æŒ¡å¹¶å‘é€åˆ° [Github Issues](https://github.com/emby-keeper/emby-keeper/issues), è°¢è°¢.

### Telegram è¢«ç™»å‡ºæˆ–å°ç¦

è‹¥æ‚¨çš„è´¦å·å­˜åœ¨å®‰å…¨é£é™©æ—¶, åŒ…æ‹¬ä½†ä¸é™äºä»¥ä¸‹æƒ…å†µ, æœ‰å°æ¦‚ç‡å¯èƒ½å¯¼è‡´åœ¨ä½¿ç”¨æ—¶è¢«ç™»å‡º, æˆ–åœ¨æ‰€æœ‰è®¾å¤‡è¢«ç™»å‡º:

1. ä½¿ç”¨ `+86` æ‰‹æœºå·
2. åœ¨å¤šä¸ªåœ°åŒºçš„ IP åœ°å€å¿«é€Ÿåˆ‡æ¢, ä¾‹å¦‚æœåŠ¡å™¨éƒ¨ç½²ä½ç½®çš„ IP å’Œæ‰‹æœºä½¿ç”¨ä»£ç†è®¿é—®çš„ IP ä½ç½®éå¸¸ä¸åŒ.
3. è´¦å·åˆšåˆšæ³¨å†Œ.
4. è´¦å·ä½¿ç”¨çš„æ˜¯è™šæ‹Ÿå·ç  (VoIP) æ³¨å†Œ.

è¯·æ³¨æ„, æ»¡è¶³è¿™äº›æ¡ä»¶ä¹Ÿä¸€èˆ¬**ä¸ä¼š**å¯¼è‡´é£æ§æˆ–å°ç¦. ä½†æ˜¯, å½“æ‚¨å‡ºç°ç™»å‡ºé—®é¢˜æ—¶, ä»ä»¥ä¸Šè§’åº¦æ’æŸ¥å¯èƒ½æ˜¯ä¸€ä¸ªå¥½çš„æ–¹å‘.

åŒæ—¶, å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯è™šæ‹Ÿå·ç  (VoIP) æ³¨å†Œ, å°¤å…¶æ˜¯æ³¨å†Œåæ— æ³•å†æ¬¡è®¿é—®å·ç çš„æƒ…å†µ, å»ºè®®æ‚¨å‚è€ƒ [å¦‚ä½•å°† Telegram ç»‘å®šé‚®ç®±](https://jp.v2ex.com/t/1037251), å¹¶å¼€å¯ä¸¤æ­¥éªŒè¯, é¿å…ä¸€æ—¦å‡ºç°é£æ§, æ‰€æœ‰è®¾å¤‡è¢«ç™»å‡º, æ— æ³•å†æ¬¡ç™»é™†çš„æƒ…å†µ.

æˆ‘ä»¬å‘ç°å¯¹äºé£æ§çš„æƒ…å†µ, å¦‚æœæ‚¨è¢«ç™»å‡º, æ‚¨å¯èƒ½åœ¨ 0-48 å°æ—¶å†…è¢«é™åˆ¶ç™»é™†.

è™½ç„¶ç›®å‰ä¸ºæ­¢**æ²¡æœ‰**æ”¶åˆ°ä»»ä½•ä½¿ç”¨è¯¥å·¥å…·å¯¼è‡´å°ç¦çš„æŠ¥å‘Š, æˆ‘ä»¬ä¹Ÿå·²ç»å¯¹ç¨‹åºè¿›è¡Œäº†éå¸¸åˆç†çš„é€Ÿç‡å’Œé£é™©æ§åˆ¶, æˆ‘ä»¬ä¾ç„¶æ— æ³•ä¿è¯ä¸ä¼šå¯¼è‡´å°ç¦, ä¹Ÿä¸å¯¹è¿™äº›é—®é¢˜è´Ÿè´£.

Telegram è¢«ç™»å‡ºå…¶å®ä¸ Telegram çš„éå…¬å¼€çš„ API é£æ§æ”¿ç­–æœ‰å…³, æˆ‘ä»¬åœ¨å¸¸ç”¨çš„ Telegram ç¨‹åºåº“ [Telethon](https://github.com/LonamiWebs/Telethon/issues/4321) å’Œ [Pyrogram](https://github.com/pyrogram/pyrogram/issues/1236) ä¸­éƒ½å‘ç°äº†ç›¸å…³çš„åé¦ˆ. åœ¨è¿™é‡Œå¯ä»¥å¼•ç”¨è¿™ä¸¤ä¸ªä¼Ÿå¤§çš„å·¥å…·åº“çš„ä½œè€…çš„è¯:

> Telethon:
>
> é¦–å…ˆ, è¿™ä¸ä»…ä»…æ˜¯æœ¬å·¥å…·çš„é—®é¢˜. ä»»ä½•ç¬¬ä¸‰æ–¹åº“éƒ½å¯èƒ½å¯¼è‡´å¸æˆ·æ˜¾ç¤ºè¢«å°ç¦.  å³ä½¿æ˜¯å®˜æ–¹åº”ç”¨ç¨‹åºåœ¨æŸäº›æƒ…å†µä¸‹ä¹Ÿå¯èƒ½å¯¼è‡´ Telegram å°ç¦å¸æˆ·. åƒ Telethon è¿™æ ·çš„ç¬¬ä¸‰æ–¹åº“ä½¿ç”¨èµ·æ¥éå¸¸ç®€å•, å› æ­¤å®ƒä»¬è¢«æ»¥ç”¨æ¥å‘é€åƒåœ¾ä¿¡æ¯, è¿™çš„ç¡®å¯èƒ½å¯¼è‡´ Telegram è¯†åˆ«æŸäº›æ¨¡å¼å¹¶ç¦æ­¢å¯ç–‘æ´»åŠ¨. ä½†æ˜¯, ä½ ä¹Ÿå¯èƒ½æ¥è‡ªä¸€ä¸ªæœ‰é™åˆ¶çš„å›½å®¶, æˆ–è™šæ‹Ÿ (VoIP) ç”µè¯å·ç . åœ¨è¿™ç§æƒ…å†µä¸‹, æˆ‘ä»¬æœ‰ä¸€ä¸ªåæ¶ˆæ¯è¦å‘Šè¯‰ä½ . Telegram æ›´æœ‰å¯èƒ½å°ç¦è¿™äº›å·ç , å› ä¸ºå®ƒä»¬ç»å¸¸è¢«ç”¨æ¥å¯¹å…¶ä»–è´¦æˆ·è¿›è¡Œåƒåœ¾é‚®ä»¶æ”»å‡», ä¸”éå¸¸å¯èƒ½æ˜¯é€šè¿‡ç±»ä¼¼è¿™æ ·çš„åº“. æˆ‘ä»¬ç»™ä½ çš„æœ€ä½³å»ºè®®æ˜¯, ä¸è¦æ»¥ç”¨ API, æ¯”å¦‚éå¸¸å¿«é€Ÿåœ°å‘é€å¤§é‡è¯·æ±‚. é€šå¸¸å»ºè®®åªåœ¨æˆç†Ÿçš„è´¦æˆ·ä¸Šä½¿ç”¨è¿™ä¸ªåº“ï¼ˆè€Œä¸æ˜¯ä½ åˆšåˆ›å»ºçš„è´¦æˆ·ï¼‰, å¹¶ä¸”ä¸è¦æ‰§è¡Œå¯èƒ½è¢«è§†ä¸ºæ»¥ç”¨çš„æ“ä½œ. Telegram å†³å®šå“ªäº›æ“ä½œå±äºæ­¤ç±»æ“ä½œ, å¹¶ä¸”ä»–ä»¬å¯ä»¥éšæ—¶æ›´æ”¹å…¶è¿ä½œæ–¹å¼. 

> Pyrogram:
>
> æˆ‘ä»¬çš„å·¥å…·ä¸­, æ²¡æœ‰ä»»ä½•é”™è¯¯ä¼šå¯¼è‡´æ‚¨çš„å¸æˆ·ç«‹å³æ¶ˆå¤±. äººä»¬åº”è¯¥æ˜ç™½, Telegram æœ‰ååƒåœ¾é‚®ä»¶ä¿æŠ¤ç³»ç»Ÿæ¥é˜²æ­¢æ»¥ç”¨å’Œåƒåœ¾ä¿¡æ¯, å½“ç„¶æˆ‘ä»¬ä¸çŸ¥é“å®ƒä»¬ç©¶ç«Ÿæ˜¯å¦‚ä½•å·¥ä½œçš„. æˆ‘ä»¬çŸ¥é“çš„æ˜¯, æˆ‘ä»¬ä¸ Telegram åˆ†äº«çš„æ‰€æœ‰å†…å®¹éƒ½å¯ç”¨äºæ£€æµ‹å¯èƒ½çš„åƒåœ¾é‚®ä»¶æ¥æºï¼šè™šæ‹Ÿ/å»‰ä»·ç”µè¯å·ç ã€IP åœ°å€ï¼ˆæ¥è‡ª Telegram å‘ç°æµé‡å¾ˆå¤§çš„å›½å®¶/åœ°åŒºï¼‰ä»¥åŠæ³„éœ²çš„ç¬¬ä¸‰æ–¹ API å¯†é’¥. 

::: details å†å²äº‹ä»¶

2024 å¹´ 12 æœˆå·¦å³, å‡ºç°äº†å¤§é‡åé¦ˆç™»é™†åç«‹åˆ»è¢«ç™»å‡ºçš„æ¡ˆä¾‹.

1. **æ— æ³•å¤ç°**: ç”±äºæˆ‘ä»¬ä¸€ç›´æ— æ³•å¤ç°, èƒ½æ­£å¸¸ä½¿ç”¨. æˆ‘ä»¬æ³¨å†Œäº†ä¸€ä¸ªæ–°è´¦å·, ä¹Ÿæ²¡æœ‰å‡ºç°è¿™ç§ç°è±¡.

   å› æ­¤, æˆ‘ä»¬å…ˆæé†’ç”¨æˆ·è‡ªè¡Œæ’æŸ¥æ³¨å†Œçš„æ‰‹æœºå·æ˜¯å¦ä¸ºè™šæ‹Ÿæ‰‹æœºå·ç­‰é£é™©å†…å®¹, ä½†æ˜¯åç»­å‡ºç°äº†çœ‹èµ·æ¥éå¸¸æ­£å¸¸ä½é£é™©çš„æ¡ˆä¾‹, æ‰€ä»¥æˆ‘ä»¬è¿›ä¸€æ­¥å¯¹ç¨‹åºè¿›è¡Œäº†æ’æŸ¥.

2. **åˆæ­¥åˆ¤æ–­**: ç”±äºæˆ‘ä»¬æ²¡æœ‰æ”¹åŠ¨ä»»ä½•å…³äºç™»é™†éƒ¨åˆ†çš„ä»£ç , æˆ‘ä»¬é¦–å…ˆæ€€ç–‘ç¨‹åºæŸå¤„æœ‰å¾ªç¯çš„è¯·æ±‚.

   ä½†æ˜¯, ç®€å•æ€è€ƒç«‹åˆ»æ’é™¤äº†å«Œç–‘:

   1. è¯·æ±‚è¶…é™æƒ…å†µä¸‹, Telegram ä¼šè¿”å› FloodWait, ç¨‹åºä¼šç­‰å¾… (`pyrogram` çš„è‡ªå¸¦åŠŸèƒ½), è€Œä¸ä¼šå¯¼è‡´é£æ§.
   2. æœ‰ç”¨æˆ·è¿˜æ²¡æœ‰å¼€å§‹ä½¿ç”¨, åˆšç™»é™†å°±è¢«ç™»å‡º, è¯´æ˜å¹¶éç¨‹åºå…¶ä»–éƒ¨åˆ†çš„é—®é¢˜.
   3. æˆ‘ä»¬è¿›è¡Œäº†è‹¥å¹²æ¬¡æ›´æ–°, ä»¥æå…¶ä¿å®ˆçš„æ–¹å¼å‘é€è¯·æ±‚, ä¾ç„¶æ²¡æœ‰ç¼“è§£.

3. **è¿›ä¸€æ­¥æŒ–æ˜**: æˆ‘ä»¬å¯¹æˆ‘ä»¬ä½¿ç”¨çš„åº“ `pyrogram` è¿›è¡Œç›¸å…³é—®é¢˜åˆ†æ, å‘ç°äº†å¤§é‡åé¦ˆ, åŒæ—¶å…¶ä»–åº“ (`telethon`) ä¹Ÿæœ‰ç±»ä¼¼çš„åé¦ˆ.

   ç›¸å…³é—®é¢˜è®°å½•åœ¨: [Github Issue](https://github.com/emby-keeper/emby-keeper/issues/67#issuecomment-2543344275) ä¸­.

4. **é—®é¢˜è§£å†³**: æˆ‘ä»¬é‡‡ç”¨äº†ä¸¤ç§æ–¹æ³•åŒç®¡é½ä¸‹, æœ€ç»ˆè§£å†³äº†è¿™ä¸ªé—®é¢˜.

   1. æœ‰ç”¨æˆ·[åé¦ˆ](https://github.com/LonamiWebs/Telethon/issues/4051#issuecomment-1491747149), ä½¿ç”¨ä¸€ä¸ªç‰¹å®šçš„ `system_version` ä½œä¸ºè¯·æ±‚å‚æ•°ç™»é™†, å¯ä»¥ç¼“è§£è¿™ä¸€ç°è±¡, ä¸”è¢«å¤§é‡è®¤å¯.

      æˆ‘ä»¬é‡‡çº³äº†è¿™ä¸ªæ–¹æ³• (è™½ç„¶è¯¥æ–¹æ³•è¢«è®¤ä¸ºåŸå› å’Œæœºåˆ¶ä¸æ˜), æƒ…å†µæœ‰æ‰€ç¼“è§£.

   2. æœ‰ç”¨æˆ·[åé¦ˆ](https://github.com/pyrogram/pyrogram/issues/1461#issuecomment-2538338026), ä½¿ç”¨ `telethon` è¿›è¡Œé¦–æ¬¡ç™»é™†, å¹¶å°† `session_string` è½¬æ¢ä¸º `pyrogram` æ ¼å¼, è¿›è¡Œç™»é™†, å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜.

      æˆ‘ä»¬é‡‡çº³äº†è¿™ä¸ªæ–¹æ³•, åœ¨é¦–æ¬¡ç™»é™†æ—¶å€™ä½¿ç”¨ `telethon`, ç»å¤šä½ç”¨æˆ·åé¦ˆ, å½»åº•è§£å†³äº†è¿™ä¸ªé—®é¢˜.

5. **æ€»ç»“ä¸æ€è€ƒ**: `pyrogram` è·ç¦»ä¸Šä¸€æ¬¡æ›´æ–°å·²ç»ä¸€å¹´å¤šäº†, åœ¨è¿™æ®µæ—¶é—´å†… Telegram çš„ API å¯èƒ½å‘ç”Ÿäº†ä¸€å®šçš„å˜åŒ–, å¯¼è‡´ `pyrogram` çš„è¯·æ±‚ç›¸è¾ƒäºå®¢æˆ·ç«¯ç‰¹å¾æ›´åŠ æ˜æ˜¾, ä»è€Œè¢« Telegram æœåŠ¡å™¨è®¤å®šä¸ºé£é™©.

:::

### Emby æœåŠ¡å™¨çš„æ¨¡æ‹Ÿç™»é™†æ¨¡å¼æ˜¯ä»€ä¹ˆ?

ç™»é™†è¿‡ç¨‹ä¼šä¼ é€’å‡ ä¸ªå…³é”®ä¿¡æ¯: `device`, `device_id`, `useragent`, `client`, `user_id`.

é»˜è®¤æƒ…å†µä¸‹:

- `device`: è®¾å¤‡å, è‡ª [v2.6.0](https://github.com/emby-keeper/emby-keeper/releases/tag/v2.6.0) åä¿æŒä¸å˜, è‡ª [v7.0.0](https://github.com/emby-keeper/emby-keeper/releases/tag/v2.6.0) åè½¬ä¸ºå¸¦ç¼“å­˜ç”Ÿæˆçš„å½¢å¼, åŒä¸€ç«™ç‚¹ä¿æŒä¸å˜.
- `device_id`: è®¾å¤‡ç , åœ¨åŒä¸€è®¾å¤‡ä¸Šæ’å®šä¸å˜, ä¸”ä¸éšç¨‹åºé‡å¯/ç¨‹åºæ›´æ–°/å®¹å™¨é‡å»ºå˜åŒ–.
- `useragent`: æ¨¡æ‹Ÿ Fileball/Filebar å‘é€çš„ UA, å¹¶ä»å‡ ä¸ª Fileball/Filebar ç‰ˆæœ¬ä¸­é€‰å–ä¸€ä¸ª.
- `client`: æ¨¡æ‹Ÿ Fileball/Filebar å‘é€çš„ Client å­—æ®µ, å¹¶ä»å‡ ä¸ª Fileball/Filebar ç‰ˆæœ¬ä¸­é€‰å–ä¸€ä¸ª.
- `client_version`: æ¨¡æ‹Ÿ Fileball/Filebar å‘é€çš„ Version å­—æ®µ, å¹¶ä»å‡ ä¸ª Fileball/Filebar ç‰ˆæœ¬ä¸­é€‰å–ä¸€ä¸ª.
- `user_id` (å·²ä¸å†æ”¯æŒè‡ªå®šä¹‰): Fileball/Filebar åœ¨è¿›è¡Œé¦–æ¬¡ç™»é™†æ—¶, ä¼šå‘é€ä¸€ä¸ªéšæœºçš„ UUID ä½œä¸º `UserID` å­—æ®µ.

æ ¹æ®æˆ‘ä»¬åœ¨è‡ªå»ºçš„ Emby æœåŠ¡å™¨å’Œ Jellyfin æœåŠ¡å™¨ä¸­çš„æµ‹è¯•ä¸­, å¤šæ¬¡ä¿æ´»ä¸ä¼šå¯¼è‡´åå°è®¾å¤‡æ˜¾ç¤ºæ•°é‡, æˆ–è®¾å¤‡ UUID æ•°é‡çš„ä¸Šæ¶¨.

ä½¿ç”¨é»˜è®¤é…ç½®, å¾ˆéš¾ä»åå°çš„ Playback ä¿¡æ¯ä¸­åˆ†è¾¨æ˜¯å¦ä¸ºè‡ªåŠ¨åŒ–ä¿æ´». ç›®å‰çš„ä¿æ´»è¯·æ±‚é¡ºåºå’Œé€»è¾‘æ˜¯æ ¹æ® Fileball/Filebar è°ƒåˆ¶çš„, ä¸æ¨èå¦è¡ŒæŠ“åŒ…å¡«å…¥å…¶ä»–å®¢æˆ·ç«¯çš„æ•°æ®.

ä½ å¯ä»¥æŸ¥çœ‹[æºä»£ç ](https://github.com/emby-keeper/emby-keeper/blob/main/embykeeper/embywatcher/emby.py)ä»¥æ›´æ¸…æ™°åœ°äº†è§£é€»è¾‘.

### éƒ¨åˆ†éœ€è¦ Cloudflare (CF) éªŒè¯ç çš„ç«™ç‚¹ä¸ºä»€ä¹ˆç­¾åˆ°å¤±è´¥?

éƒ¨åˆ†éœ€è¦éªŒè¯ç çš„æœåŠ¡ (æœªå“, Nebula ç­‰) ç­¾åˆ°å¤±è´¥çš„åŸå› å¯èƒ½åŒ…æ‹¬:

1. æ‚¨ä¸æ˜¯ `SUPER` ç­‰çº§ç”¨æˆ·, å› æ­¤æ— æ³•è§£æ CF éªŒè¯ç . (æ‚¨åº”è¯¥å¯ä»¥åœ¨æ—¥å¿—çœ‹åˆ°ç›¸å…³ä¿¡æ¯)
2. æœåŠ¡ç«¯è§£æé”™è¯¯, å¯èƒ½æ˜¯éªŒè¯ç è§£ææš‚ä¸å¯ç”¨, è¯·è”ç³»å¼€å‘è€…. (æ‚¨åº”è¯¥å¯ä»¥åœ¨æ—¥å¿—çœ‹åˆ°ç›¸å…³ä¿¡æ¯)
3. éä»¥ä¸Šé—®é¢˜, ä½†æ˜¯ä¾ç„¶å‡ºé”™, å¯èƒ½æ˜¯å› ä¸ºæ‚¨çš„ç½‘ç»œé£æ§ç­‰çº§è¾ƒé«˜, å³ä½¿è¿œç«¯è§£æäº†éªŒè¯ç , ä¾ç„¶æ— æ³•é€šè¿‡ CF çš„ IP æ£€æŸ¥.

   (æ—¥å¿—æ˜¾ç¤º: "éªŒè¯ç è¯†åˆ«åæ¥å£è¿”å›å¼‚å¸¸ä¿¡æ¯")

   è‹¥ä¸ºè¿™ç§æƒ…å†µ, åˆ™è¯·å°è¯•åœ¨åœ¨è¿è¡Œæ—¶å€™å¢åŠ  `-d` å‘½ä»¤è¡Œå‚æ•°, å¹¶æ ¹æ®è¾“å‡ºçš„ç½‘å€, åœ¨è¿è¡Œ Embykeeper çš„è®¾å¤‡ä¸­çš„æµè§ˆå™¨æ‰“å¼€, è§£éªŒè¯ç å¹¶é‡æ–°è¿è¡Œ.

:::info ä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸èƒ½ç›´æ¥åœ¨æœåŠ¡å™¨ç«¯å‘é€ç­¾åˆ°çš„è¯·æ±‚?

æˆ‘ä»¬çš„æœåŠ¡ç›®å‰ä»…æ”¯æŒè§£æéªŒè¯ç åè¿”å›ä»¤ç‰Œ, æ‚¨è¿è¡Œ Embykeeper çš„è®¾å¤‡å†åˆ©ç”¨è¿™ä¸ªä»¤ç‰Œå‘ç«™ç‚¹æœåŠ¡å™¨å‘é€è¯·æ±‚, å› æ­¤å¯èƒ½å‡ºç°ç”±äºç½‘ç»œé£æ§ç­‰çº§è¾ƒé«˜è€Œæ— æ³•é€šè¿‡ CF çš„ IP æ£€æŸ¥.

æ‚¨å¯èƒ½ä¼šé—®, å¦‚æœåœ¨æˆ‘ä»¬è§£æéªŒè¯ç çš„æœåŠ¡å™¨ç«¯å‘é€ç­¾åˆ°çš„è¯·æ±‚, æ˜¯å¦å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜?

å¯æƒœçš„æ˜¯, æˆ‘ä»¬æ— æ³•ä¸ºæ‚¨ä»£å‘é€è¯·æ±‚.

ä¸€æ–¹é¢, è¯¥è¯·æ±‚å‚æ•°å¯èƒ½åŒ…å«æ‚¨è´¦æˆ·çš„ä¿¡æ¯, å‘é€è‡³æˆ‘ä»¬çš„æœåŠ¡å™¨ä¸ç¬¦åˆæˆ‘ä»¬çš„å®‰å…¨è¦æ±‚.

å¦ä¸€æ–¹é¢, å¦‚æœè¿™ä¹ˆåš, ç«™ç‚¹ç®¡ç†å‘˜å¯ä»¥é€šè¿‡è¯·æ±‚çš„IPæ‰¾åˆ°æˆ‘ä»¬çš„æœåŠ¡å™¨, è¿›è¡Œæ‰¹é‡å°ç¦.
:::

### è°ƒè¯•æ—¥å¿—ä¸­, æ¯æ¬¡éƒ½ä¼šæ˜¾ç¤º "ç™»å‡ºè´¦å·", æ˜¯å¦åå¤ç™»å‡ºä¼šå¯¼è‡´é£æ§?

ä¸, è¿™é‡Œçš„ç™»å‡ºè´¦å·æ„æ€ä¸º "åœæ­¢ç›‘å¬æ¥è‡ªè¯¥è´¦å·çš„æ›´æ–°", ç­‰åŒäºå…³é—­ Telegram åº”ç”¨, å¹¶éå®é™…ç™»å‡ºè´¦å·, ä¹Ÿä¸ä¼šå‘é€å’Œç™»å‡ºç›¸å…³çš„ä»»ä½•æŒ‡ä»¤ç»™ Telegram.

### ä¿æ´»æ—¶å‡ºç°é”™è¯¯: Unexpected JSON output...

è¿™å¯èƒ½æœ‰å‡ ç§æƒ…å†µ:

1. Error processing request (403): æ²¡æœ‰è®¾ç½® Emby å¯†ç , åœ¨æŸäº› Emby ç‰ˆæœ¬ä¸­å¯èƒ½å‡ºç°é”™è¯¯.
2. ç½‘é¡µæ•°æ®, ç±»ä¼¼ `<!doctype html>` ç­‰å¼€å¤´çš„å†…å®¹: è¯·æ‰‹åŠ¨æ‰“å¼€ `https://example.com/System/Info/Public`, æ£€æŸ¥å‡ºç°äº†ä»€ä¹ˆé—®é¢˜.

### ä¿æ´»æ˜¯å¦æœ‰å’Œæ’­æ”¾å™¨è½¯ä»¶ä¸€è‡´çš„è¡Œä¸º?

ç›®å‰è½¯ä»¶é»˜è®¤æ¨¡æ‹Ÿ Fileball/Filebar è½¯ä»¶è¿›è¡Œæ’­æ”¾:

Fileball/Filebar è½¯ä»¶é¦–æ¬¡ç™»é™†æ—¶çš„ Emby æ—¥å¿—:

```
Info Server: http/1.1 POST http://â€Œâ€â€example.comâ€Œ/emby/Users/AuthenticateByName. Source Ip: â€Œâ€1.1.1.1, Accept=*/*, Host=â€Œâ€â€example.comâ€Œ, User-Agent=Fileball/1.3.30, Accept-Encoding=gzip, br, Accept-Language=zh-CN,zh-Hans;q=0.9, Content-Type=application/json, Content-Length=52, Cdn-Loop=cloudflare; loops=1, Cf-Connecting-Ip=1.1.1.1, Cf-Ipcountry=MU, Cf-Ray=123456-HKG, Cf-Visitor={"scheme":"https"}, X-Emby-Authorization=MediaBrowser Token=,Emby UserId=(æ¯æ¬¡ç™»é™†éƒ½ä¼šå˜),Client=Fileball,Device=ABC%E2%80%99s%20iPhone,DeviceId=(éšè®¾å¤‡å˜åŒ–),Version=1.3.30, X-Forwarded-For=â€Œâ€1.1.1.1, X-Forwarded-Host=â€Œâ€â€example.comâ€Œ, X-Forwarded-Port=443, X-Forwarded-Proto=https, X-Forwarded-Server=123456, X-Real-Ip=â€Œâ€1.1.1.1
Info UserManager: Authentication request for user1 has succeeded.

Info SessionManager: Reissuing access token: (æ¯æ¬¡ç™»é™†ä¸ä¼šå˜)
Info Server: http/1.1 Response 200 to â€Œâ€1.1.1.1. Time: 5ms. POST http://â€Œâ€â€example.comâ€Œ/emby/Users/AuthenticateByName
Info App: Sqlite: 284 - automatic index on LastWatchedEpisodes(SeriesPresentationUniqueKey)
```

å†æ¬¡ç™»é™†å¹¶è®¿é—®ä¸€ä¸ªè§†é¢‘ (ç¬¬äºŒæ¬¡ç™»é™†ç›´æ¥ä½¿ç”¨äº†Token):

```
Server: http/1.1 GET http://â€Œâ€â€example.com/emby/Videos/1234/AdditionalParts?Fields=PrimaryImageAspectRatio,UserData,CanDelete&IncludeItemTypes=Playlist,BoxSet&Recursive=true&SortBy=SortName. Source Ip: â€Œâ€â€1.1.1.1, Accept=*/*, Host=â€Œâ€â€example.com, User-Agent=Fileball/1.3.30, Accept-Encoding=gzip, br, Accept-Language=zh-CN,zh-Hans;q=0.9, Cdn-Loop=cloudflare; loops=1, Cf-Connecting-Ip=1.1.1.1, Cf-Ipcountry=MU, Cf-Ray=123456-HKG, Cf-Visitor={"scheme":"https"}, X-Emby-Authorization=MediaBrowser Token=(å‘é€çš„ token),Emby UserId=(ç™»é™†æ—¶çš„UserId),Client=Fileball,Device=ABC%E2%80%99s%20iPhone,DeviceId=(éšè®¾å¤‡å˜åŒ–),Version=1.3.30, X-Emby-Token=(å‘é€çš„ token), X-Forwarded-For=â€Œâ€â€Œ1.1.1.1, X-Forwarded-Host=â€Œâ€â€example.com, X-Forwarded-Port=443, X-Forwarded-Proto=https, X-Forwarded-Server=123456, X-Real-Ip=1.1.1.1
```

å¼€å§‹æ’­æ”¾è§†é¢‘:

```
Server: http/1.1 POST http://â€Œâ€example.comâ€Œ/emby/Items/1234/PlaybackInfo?AutoOpenLiveStream=false&IsPlayback=false&MaxStreamingBitrate=42000000&MediaSourceId=84466298f4e9d5135dee212204bbed3b&StartTimeTicks=0&UserId=35e7a33dbf1445958b0719747d1111fe. Source Ip: â€Œâ€1.1.1.1, UserAgent: Fileball/1.3.30
(å‘é€è‹¥å¹²æ¡)

Server: http/1.1 GET http://â€Œâ€example.comâ€Œ/emby/videos/1234/original.mp4?DeviceId=(éšè®¾å¤‡å˜åŒ–)&MediaSourceId=84466298f4e9d5135dee212204bbed3b&PlaySessionId=02981190f6c44a02b3015b7bbd372511&api_key=â€Œ52c91904f5ef4bae8cb075394a114e66â€Œ. Source Ip: â€Œâ€â€1.1.1.1â€Œ, Accept=*/*, Host=â€Œâ€example.comâ€Œ, User-Agent=VLC/3.0.21 LibVLC/3.0.21, Accept-Encoding=gzip, br, Accept-Language=en_US, Cdn-Loop=cloudflare; loops=1, Cf-Connecting-Ip=1.1.1.1, Cf-Ipcountry=MU, Cf-Ray=123456-HKG, Cf-Visitor={"scheme":"https"}, X-Forwarded-For=â€Œâ€â€1.1.1.1â€Œ, X-Forwarded-Host=â€Œâ€example.comâ€Œ, X-Forwarded-Port=443, X-Forwarded-Proto=https, X-Forwarded-Server=123456, X-Real-Ip=â€Œâ€â€1.1.1.1â€Œ
(å‘é€è‹¥å¹²æ¡)

Server: http/1.1 POST http://â€Œâ€example.comâ€Œ/emby/Sessions/Playing. Source Ip: 1.1.1.1â€Œ, UserAgent: Fileball/1.3.30

Server: http/1.1 POST http://â€Œâ€example.comâ€Œ/emby/Sessions/Playing/Progress. Source Ip: 1.1.1.1â€Œ, UserAgent: Fileball/1.3.30
(å‘é€è‹¥å¹²æ¡)

Server: http/1.1 POST http://â€Œâ€example.comâ€Œ/emby/Sessions/Playing/Stopped. Source Ip: 1.1.1.1â€Œ, UserAgent: Fileball/1.3.30
```

Embykeeper å·²å°½å¯èƒ½å®ç°äº†ç›¸åŒçš„æ¨¡æ‹Ÿæ’­æ”¾æ—¥å¿—.
